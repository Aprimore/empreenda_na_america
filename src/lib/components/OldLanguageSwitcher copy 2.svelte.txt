<script lang="ts">
	// import Dropdown from './Dropdown.svelte';
	import { t, locales, locale } from '$lib/translations';
	import { page } from '$app/stores';
	import { goto } from '$app/navigation';
	import { brazil_svg, spain_svg, usa_svg } from '$lib';
	import { onMount } from 'svelte';

	$: ({ route } = $page.data);

	const languages = [
		{ code: 'en', name: 'English' },
		{ code: 'es', name: 'Español' },
		{ code: 'pt-br', name: 'Português' }
	];

	const flagsMap = {
		en: usa_svg,
		pt: brazil_svg,
		es: spain_svg
	};
</script>

<select on:change={({ target }) => goto(target.value)}>
	{#each $locales as lc}
		<option value="/{lc}{route}" selected={lc === $locale}>{$t(`lang.${lc}`)}</option>
	{/each}
</select>

<!-- <Dropdown {languages} {flagsMap} onChange={handleOnChange} /> -->
<!-- <Dropdown {languages} {flagsMap} {selected} onChange={handleOnChange} /> -->

<!-- <script lang="ts">
	import Dropdown from '$lib/components/Dropdown.svelte';
	import { currentLocale } from '$lib/store';
	import { locale } from '$lib/translations';
	import { onDestroy, onMount } from 'svelte';

	// Initialize the page path from $page store
	let pagePath = $page.url.pathname;
	$: pagePath = $page.url.pathname;

	// Subscribe to the currentLocale store to get the selected locale
	let selected = '';

	// Synchronize selected value with the store
	const unsubscribe = currentLocale.subscribe((value) => {
		selected = value;
		locale.set(value); // Set the locale in i18n
	});

	// Cleanup subscription when the component is destroyed
	onDestroy(() => {
		unsubscribe();
	});

	// Handle the change in language selection
	const handleOnChange = (newLocale: any) => {
		if (newLocale !== selected) {
			currentLocale.set(newLocale);
			locale.set(newLocale);
			const newPath = pagePath.replace(/^\/[a-z]{2}(?:-[a-z]{2})?/, `/${newLocale}`);
			// Manually update the <html lang="..."> tag
			document.documentElement.lang = newLocale;
			goto(newPath);
		}
	};
</script>

<Dropdown {languages} {flagsMap} {selected} onChange={handleOnChange} /> -->
