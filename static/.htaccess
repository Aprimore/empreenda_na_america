RewriteEngine On
RewriteBase /

################
# Force HTTPS: #
################
# RewriteCond %{HTTPS} off
# RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

##############################################
# Skip redirection if locale already present #
##############################################
RewriteRule ^en(\/.*)?$ - [L]
RewriteRule ^es(\/.*)?$ - [L]
RewriteRule ^pt-br(\/.*)?$ - [L]

#############################
# Serve files if they exist #
#############################
RewriteCond %{REQUEST_FILENAME} -f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ - [L]

#############################
# MIME TYPE FIX COMPRESSION #              
#############################
<IfModule mod_mime.c>
  AddType application/javascript .js
</IfModule>

####################
# GZIP COMPRESSION #              
####################
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/x-javascript application/xml application/json
    # For older browsers that don't support compression
    BrowserMatch ^Mozilla/4 gzip-only-text/html
    BrowserMatch ^Mozilla/4\.0[678] no-gzip
    BrowserMatch \bMSIE !no-gzip !gzip-only-text/html
    Header append Vary User-Agent
</IfModule>

#############################################
# Enforce Strict Transport Security (HSTS)  #
#############################################
<IfModule mod_headers.c>
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    Header set X-XSS-Protection "1; mode=block"
</IfModule>

##################################
# Hide Server Signature:         #
##################################
# ServerSignature Off

##################################
# Disable Caching for Testing    #
##################################
# <IfModule mod_headers.c>
#     # Set Cache-Control headers to no-cache, no-store for all files
#     Header set Cache-Control "no-cache, no-store, must-revalidate"
#     Header set Pragma "no-cache"
#     Header set Expires "0"
# </IfModule>

##################################
# 1 hour cache                   #
##################################
<IfModule mod_expires.c>
    ExpiresActive On

    # Set default caching to 1 hour
    ExpiresDefault "access plus 1 hour"

    # Set specific file types to cache for 1 hour
    ExpiresByType image/jpg "access plus 1 hour"
    ExpiresByType image/jpeg "access plus 1 hour"
    ExpiresByType image/gif "access plus 1 hour"
    ExpiresByType image/png "access plus 1 hour"
    ExpiresByType text/css "access plus 1 hour"
    ExpiresByType text/javascript "access plus 1 hour"
    ExpiresByType application/javascript "access plus 1 hour"
    ExpiresByType application/x-javascript "access plus 1 hour"
    ExpiresByType application/pdf "access plus 1 hour"
    ExpiresByType application/x-shockwave-flash "access plus 1 hour"
    ExpiresByType image/x-icon "access plus 1 hour"
    ExpiresByType text/html "access plus 1 hour"
    ExpiresByType application/json "access plus 1 hour"
</IfModule>
# cache-control headers
<IfModule mod_headers.c>
    Header set Cache-Control "max-age=3600, public"
</IfModule>

# <IfModule mod_expires.c>
    ##################################
    # LEVERAGE BROWSER CACHING       #
    ##################################
    # ExpiresActive On
    # ExpiresByType image/jpg "access plus 1 year"
    # ExpiresByType image/jpeg "access plus 1 year"
    # ExpiresByType image/gif "access plus 1 year"
    # ExpiresByType image/png "access plus 1 year"
    # ExpiresByType text/css "access plus 1 month"
    # ExpiresByType application/pdf "access plus 1 month"
    # ExpiresByType text/x-javascript "access plus 1 month"
    # ExpiresByType application/x-shockwave-flash "access plus 1 month"
    # ExpiresByType image/x-icon "access plus 1 year"
    # ExpiresDefault "access plus 2 days"
# </IfModule>


# Prevent dot directories (hidden directories like .git) to be exposed to the public
# Except for the .well-known directory used by LetsEncrypt a.o
# RewriteRule "/\.|^\.(?!well-known/)" - [F]

# Rewrite www.example.com -> example.com -- used with SEO Strict URLs plugin
# RewriteCond %{HTTP_HOST} .
# RewriteCond %{HTTP_HOST} ^www.(.*)$ [NC]
# RewriteRule ^(.*)$ https://%1/$1 [R=301,L]

# Rewrite secure requests properly to prevent SSL cert warnings, e.g. prevent 
# https://www.example.com when your cert only allows https://secure.example.com
# RewriteCond %{SERVER_PORT} !^443
# RewriteRule (.*) https://%{SERVER_NAME}/$1 [R=301,L]